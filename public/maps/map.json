{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "map",
  "title": "Map (React Native)",
  "description": "A MapLibre-powered map component for React Native with markers, popups, labels, routes, and controls.",
  "dependencies": [
    "@maplibre/maplibre-react-native@11.0.0-alpha.28",
    "expo-location@^19.0.8"
  ],
  "registryDependencies": [],
  "files": [
    {
      "path": "src/registry/map.txt",
      "content": "import { useTheme } from \"@/lib/theme-context\";\nimport { cn } from \"@/lib/utils\";\nimport {\n  Callout,\n  Camera,\n  LineLayer,\n  LocationManager,\n  MapView,\n  MarkerView,\n  ShapeSource,\n  UserLocation,\n  useCurrentPosition,\n  type CameraRef,\n  type MapViewRef,\n} from \"@maplibre/maplibre-react-native\";\nimport {\n  createContext,\n  useContext,\n  useEffect,\n  useId,\n  useRef,\n  useState,\n  type ReactNode,\n} from \"react\";\nimport {\n  ActivityIndicator,\n  Pressable,\n  Text,\n  View\n} from \"react-native\";\n\ntype MapContextValue = {\n  mapRef: React.RefObject<MapViewRef | null>;\n  cameraRef: React.RefObject<CameraRef | null>;\n  isLoaded: boolean;\n  theme: \"light\" | \"dark\";\n};\n\nconst MapContext = createContext<MapContextValue | null>(null);\n\nfunction useMap() {\n  const context = useContext(MapContext);\n  if (!context) {\n    throw new Error(\"useMap must be used within a Map component\");\n  }\n  return context;\n}\n\nconst defaultStyles = {\n  dark: \"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json\",\n  light: \"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json\",\n};\n\ntype MapStyleOption = string | object;\n\ntype MapProps = {\n  children?: ReactNode;\n  /** Custom map styles for light and dark themes. Overrides the default Carto styles. */\n  styles?: {\n    light?: MapStyleOption;\n    dark?: MapStyleOption;\n  };\n  /** Initial center coordinate [longitude, latitude] */\n  center?: [number, number];\n  /** Initial zoom level */\n  zoom?: number;\n  /** Container style */\n  className?: string;\n  /** Show loading indicator */\n  showLoader?: boolean;\n};\n\nconst DefaultLoader = () => (\n  <View className=\"absolute inset-0 justify-center items-center bg-white/80\">\n    <ActivityIndicator size=\"small\" color=\"#999\" />\n  </View>\n);\n\nfunction Map({\n  children,\n  styles,\n  center = [0, 0],\n  zoom = 10,\n  className,\n  showLoader = true,\n}: MapProps) {\n  const mapRef = useRef<MapViewRef | null>(null);\n  const cameraRef = useRef<CameraRef | null>(null);\n  const [isLoaded, setIsLoaded] = useState(false);\n  const { colorScheme } = useTheme();\n  const theme = colorScheme === \"dark\" ? \"dark\" : \"light\";\n\n  const mapStyle =\n    theme === \"dark\"\n      ? styles?.dark ?? defaultStyles.dark\n      : styles?.light ?? defaultStyles.light;\n\n  const handleMapIdle = () => {\n    if (!isLoaded) {\n      setIsLoaded(true);\n    }\n  };\n\n  return (\n    <MapContext.Provider value={{ mapRef, cameraRef, isLoaded, theme }}>\n      <View className={cn(\"flex-1 relative\", className)}>\n        <MapView\n          ref={mapRef}\n          style={{ flex: 1 }}\n          mapStyle={mapStyle}\n          onDidFinishLoadingMap={handleMapIdle}\n          compass={false}\n          logo={false}\n          attribution={false}\n        >\n          <Camera\n            ref={cameraRef}\n            zoom={zoom}\n            center={center}\n            easing=\"fly\"\n            duration={1000}\n          />\n          {children}\n        </MapView>\n        {showLoader && !isLoaded && <DefaultLoader />}\n      </View>\n    </MapContext.Provider>\n  );\n}\n\ntype MarkerContextValue = {\n  coordinate: [number, number];\n};\n\nconst MarkerContext = createContext<MarkerContextValue | null>(null);\n\ntype MapMarkerProps = {\n  children?: ReactNode;\n  label?: string;\n  /** Anchor point for the marker (0.0 to 1.0). Default is center (0.5, 0.5) */\n  anchor?: { x: number; y: number };\n  /** Allow marker to overlap with other markers */\n  allowOverlap?: boolean;\n  /** Callback when marker is pressed */\n  onPress?: () => void;\n} & (\n  | { coordinate: [number, number]; longitude?: never; latitude?: never }\n  | { longitude: number; latitude: number; coordinate?: never }\n);\n\nfunction MapMarker({\n  children,\n  label,\n  anchor = { x: 0.5, y: 0.5 },\n  allowOverlap = false,\n  onPress,\n  ...positionProps\n}: MapMarkerProps) {\n  const id = useId();\n\n  const coordinate: [number, number] = 'coordinate' in positionProps && positionProps.coordinate\n    ? positionProps.coordinate\n    : [positionProps.longitude, positionProps.latitude];\n\n  return (\n    <MarkerContext.Provider value={{ coordinate }}>\n      <MarkerView\n        id={id}\n        coordinate={coordinate}\n        anchor={anchor}\n        allowOverlap={allowOverlap}\n      >\n        <Pressable onPress={onPress}>\n          <View className=\"flex flex-row items-center justify-center\">\n            {children || <DefaultMarkerIcon />}\n            {label && <MarkerLabel>{label}</MarkerLabel>}\n          </View>\n        </Pressable>\n      </MarkerView>\n    </MarkerContext.Provider>\n  );\n}\n\ntype MarkerContentProps = {\n  children?: ReactNode;\n  className?: string;\n};\n\nfunction MarkerContent({ children, className }: MarkerContentProps) {\n  return (\n    <View className={cn(\"items-center justify-center\", className)}>\n      {children || <DefaultMarkerIcon />}\n    </View>\n  );\n}\n\nfunction DefaultMarkerIcon() {\n  return <View className=\"w-4 h-4 rounded-full bg-blue-500 border-2 border-white shadow-md\" style={{ elevation: 5 }} />;\n}\n\ntype MarkerPopupProps = {\n  children: ReactNode;\n  className?: string;\n  /** Title text for the callout */\n  title?: string;\n};\n\nfunction MarkerPopup({ children, className, title }: MarkerPopupProps) {\n  return (\n    <Callout title={title} className={className}>\n      <View className=\"p-3 min-w-[100px] max-w-[300px]\">{children}</View>\n    </Callout>\n  );\n}\n\ntype MarkerLabelProps = {\n  children: ReactNode;\n  className?: string;\n  classNameText?: string;\n  position?: \"top\" | \"bottom\";\n};\n\nfunction MarkerLabel({\n  children,\n  className,\n  classNameText,\n  position = \"top\",\n}: MarkerLabelProps) {\n  return (\n    <View\n      className={cn(\n        \"absolute left-1/2 translate-x-[-50%]\",\n        position === \"top\" ? \"mb-1 bottom-full\" : \"mt-1 top-full\",\n        className\n      )}\n    >\n      <Text className={cn(\"text-[10px] font-semibold text-foreground\", classNameText)}>{children}</Text>\n    </View>\n  );\n}\n\ntype MapControlsProps = {\n  position?: \"top-left\" | \"top-right\" | \"bottom-left\" | \"bottom-right\";\n  showZoom?: boolean;\n  showLocate?: boolean;\n  className?: string;\n  onLocate?: (coords: { longitude: number; latitude: number }) => void;\n};\n\nfunction MapControls({\n  position = \"bottom-right\",\n  showZoom = true,\n  showLocate = false,\n  className,\n  onLocate,\n}: MapControlsProps) {\n  const { cameraRef, mapRef, isLoaded } = useMap();\n  const [waitingForLocation, setWaitingForLocation] = useState(false);\n  const [currentZoom, setCurrentZoom] = useState(10);\n\n  const handleZoomIn = async () => {\n    if (cameraRef.current && mapRef.current) {\n      const center = await mapRef.current.getCenter();\n      const newZoom = Math.min(currentZoom + 1, 20);\n      setCurrentZoom(newZoom);\n      cameraRef.current.easeTo({\n        center: center, // LngLat is already [longitude, latitude]\n        zoom: newZoom,\n        duration: 300,\n      });\n    }\n  };\n\n  const handleZoomOut = async () => {\n    if (cameraRef.current && mapRef.current) {\n      const center = await mapRef.current.getCenter();\n      const newZoom = Math.max(currentZoom - 1, 0);\n      setCurrentZoom(newZoom);\n      cameraRef.current.easeTo({\n        center: center, // LngLat is already [longitude, latitude]\n        zoom: newZoom,\n        duration: 300,\n      });\n    }\n  };\n\n  const handleLocate = async () => {\n    setWaitingForLocation(true);\n    try {\n      // Location handling would need native permissions setup\n      // This is a simplified version\n      if (cameraRef.current && onLocate) {\n        // You would get actual location here\n        const coords = { longitude: 0, latitude: 0 };\n        cameraRef.current.flyTo({\n          center: [coords.longitude, coords.latitude],\n          zoom: 14,\n          duration: 1500,\n        });\n        onLocate(coords);\n      }\n    } catch (error) {\n      console.error(\"Error getting location:\", error);\n    } finally {\n      setWaitingForLocation(false);\n    }\n  };\n\n  if (!isLoaded) return null;\n\n  const positionStyle = {\n    \"top-left\": { top: 8, left: 8 },\n    \"top-right\": { top: 8, right: 8 },\n    \"bottom-left\": { bottom: 8, left: 8 },\n    \"bottom-right\": { bottom: 8, right: 8 },\n  }[position];\n\n  return (\n    <View className={cn(\"absolute gap-1.5\", className)} style={positionStyle}>\n      {showZoom && (\n        <View className=\"rounded border border-gray-200 bg-white shadow-sm overflow-hidden\" style={{ elevation: 2 }}>\n          <ControlButton onPress={handleZoomIn} label=\"+\">\n            <Text className=\"text-lg font-semibold text-gray-700\">+</Text>\n          </ControlButton>\n          <View className=\"h-[1px] bg-gray-200\" />\n          <ControlButton onPress={handleZoomOut} label=\"-\">\n            <Text className=\"text-lg font-semibold text-gray-700\">‚àí</Text>\n          </ControlButton>\n        </View>\n      )}\n      {showLocate && (\n        <View className=\"rounded border border-gray-200 bg-white shadow-sm overflow-hidden\" style={{ elevation: 2 }}>\n          <ControlButton\n            onPress={handleLocate}\n            label=\"üìç\"\n            disabled={waitingForLocation}\n          >\n            {waitingForLocation ? (\n              <ActivityIndicator size=\"small\" color=\"#666\" />\n            ) : (\n              <Text className=\"text-lg font-semibold text-gray-700\">üìç</Text>\n            )}\n          </ControlButton>\n        </View>\n      )}\n    </View>\n  );\n}\n\nfunction ControlButton({\n  onPress,\n  label,\n  children,\n  disabled = false,\n}: {\n  onPress: () => void;\n  label: string;\n  children: React.ReactNode;\n  disabled?: boolean;\n}) {\n  return (\n    <Pressable\n      onPress={onPress}\n      disabled={disabled}\n      className=\"w-8 h-8 justify-center items-center active:bg-gray-100\"\n      style={disabled ? { opacity: 0.5 } : undefined}\n      accessibilityLabel={label}\n      accessibilityRole=\"button\"\n    >\n      {children}\n    </Pressable>\n  );\n}\n\ntype MapRouteProps = {\n  coordinates: Array<[number, number]>;\n  color?: string;\n  width?: number;\n  opacity?: number;\n  dashArray?: [number, number];\n};\n\nfunction MapRoute({\n  coordinates,\n  color = \"#4285F4\",\n  width = 3,\n  opacity = 0.8,\n  dashArray,\n}: MapRouteProps) {\n  const id = useId();\n  const sourceId = `route-source-${id}`;\n  const layerId = `route-layer-${id}`;\n\n  if (coordinates.length < 2) {\n    return null;\n  }\n\n  const shape = {\n    type: \"Feature\" as const,\n    properties: {},\n    geometry: {\n      type: \"LineString\" as const,\n      coordinates,\n    },\n  };\n\n  return (\n    <ShapeSource id={sourceId} shape={shape}>\n      <LineLayer\n        id={layerId}\n        style={{\n          lineColor: color,\n          lineWidth: width,\n          lineOpacity: opacity,\n          ...(dashArray && { lineDasharray: dashArray }),\n          lineJoin: \"round\",\n          lineCap: \"round\",\n        }}\n      />\n    </ShapeSource>\n  );\n}\n\ntype MapUserLocationProps = {\n  /** Show user location on the map */\n  visible?: boolean;\n  /** Show accuracy circle around user location */\n  showAccuracy?: boolean;\n  /** Show heading arrow indicating device direction */\n  showHeading?: boolean;\n  /** Whether the location marker is animated between updates */\n  animated?: boolean;\n  /** Minimum delta in meters for location updates */\n  minDisplacement?: number;\n  /** Callback when user location is pressed */\n  onPress?: () => void;\n  /** Auto-request location permissions if not granted */\n  autoRequestPermission?: boolean;\n};\n\nfunction MapUserLocation({\n  visible = true,\n  showAccuracy = true,\n  showHeading = false,\n  animated = true,\n  minDisplacement,\n  onPress,\n  autoRequestPermission = true,\n}: MapUserLocationProps) {\n  const [hasPermission, setHasPermission] = useState(false);\n  const [permissionChecked, setPermissionChecked] = useState(false);\n\n  useEffect(() => {\n    let mounted = true;\n\n    const checkAndRequestPermissions = async () => {\n      try {\n        if (autoRequestPermission) {\n          const granted = await LocationManager.requestPermissions();\n          if (mounted) {\n            setHasPermission(granted);\n            setPermissionChecked(true);\n          }\n        } else {\n          if (mounted) {\n            setPermissionChecked(true);\n          }\n        }\n      } catch (error) {\n        console.error(\"Error requesting location permissions:\", error);\n        if (mounted) {\n          setHasPermission(false);\n          setPermissionChecked(true);\n        }\n      }\n    };\n\n    if (visible) {\n      checkAndRequestPermissions();\n    }\n\n    return () => {\n      mounted = false;\n    };\n  }, [visible, autoRequestPermission]);\n\n  if (!visible || !permissionChecked || !hasPermission) {\n    return null;\n  }\n\n  return (\n    <UserLocation\n      accuracy={showAccuracy}\n      heading={showHeading}\n      animated={animated}\n      minDisplacement={minDisplacement}\n      onPress={onPress}\n    />\n  );\n}\n\n// Re-export LocationManager for permission handling\nexport { LocationManager };\n\n  export {\n    Map,\n    MapControls,\n    MapMarker,\n    MapRoute,\n    MapUserLocation,\n    MarkerContent,\n    MarkerLabel,\n    MarkerPopup,\n    useCurrentPosition,\n    useMap\n  };\n\n",
      "type": "registry:ui",
      "target": "components/ui/map.tsx"
    }
  ],
  "type": "registry:ui"
}